/*!
    Title: Dev Portfolio Template
    Version: 1.2.2
    Last Change: 03/25/2020
    Author: Ryan Fitzgerald
    Repo: https://github.com/RyanFitzgerald/devportfolio-template
    Issues: https://github.com/RyanFitzgerald/devportfolio-template/issues

    Description: This file contains all the scripts associated with the single-page
    portfolio website.
*/
! function(n) {
    n("html").removeClass("no-js"), 
    n("header a").click(function(e) {
        if (!n(this).hasClass("no-scroll")) {
            e.preventDefault();
            var t = n(this).attr("href"),
                i = n(t).offset().top;
            n("html, body").animate({
                scrollTop: i + "px"
            }, +Math.abs(window.pageYOffset - n(t).offset().top)), n("header").hasClass("active") && n("header, body").removeClass("active")
        }
    }), n("#to-top").click(function() {
        n("html, body").animate({
            scrollTop: 0
        }, 500)
    }), n("#lead-down span").click(function() { //
        var e = n("#lead").next().offset().top;
        n("html, body").animate({
            scrollTop: e + "px"
        }, 500)
    }), n("#experience-timeline").each(function() {
        $this = n(this), $userContent = $this.children("div"), $userContent.each(function() {
            n(this).addClass("vtimeline-content").wrap('<div class="vtimeline-point"><div class="vtimeline-block"></div></div>')
        }), $this.find(".vtimeline-point").each(function() {
            n(this).prepend('<div class="vtimeline-icon"><i class="fa fa-map-marker"></i></div>')
        }), $this.find(".vtimeline-content").each(function() {
            var e = n(this).data("date");
            e && n(this).parent().prepend('<span class="vtimeline-date">' + e + "</span>")
        })
    }), n("#mobile-menu-open").click(function() {
        n("header, body").addClass("active")
    }), n("#mobile-menu-close").click(function() {
        n("header, body").removeClass("active")
    }), n("#view-more-projects").click(function(e) {
        e.preventDefault(), n(this).fadeOut(300, function() {
            n("#more-projects").fadeIn(300)
        })
    }), n(".project-image").each(function(e) {
        console.log("> ",e, typeof(e), $( this )[0].children);
        // $( this )[0].style.height="200px";
        
        $( this )[0].children[0].width = 300;
        $( this )[0].children[0].style.marginLeft = "-100px";
        $( this )[0].children[0].style.marginTop = (-100).toString()+"px";
        console.log("> ",e, typeof(e), $( this )[0].children);
    })
}(jQuery);
getTop = el => el.offsetTop + (el.offsetParent && getTop(el.offsetParent))
function scaleVal(value, sourceRangeMin, sourceRangeMax, targetRangeMin, targetRangeMax) {
    var targetRange = targetRangeMax - targetRangeMin;
    var sourceRange = sourceRangeMax - sourceRangeMin;
    return (value - sourceRangeMin) * targetRange / sourceRange + targetRangeMin;
}
function clamp(val, min, max) {
    return val > max ? max : val < min ? min : val;
}
window.addEventListener("resize", updateProjImgs);
window.addEventListener("scroll", updateProjImgs);

function updateProjImgs(){
    
    let po=parseInt(window.pageYOffset);
    let ph=parseInt(window.innerHeight);
    let pw=parseInt(window.innerWidth);
    let smallflag=false;
    if (pw<=800) smallflag=true;
    let off=po+(ph-300)/2;
    let f=40;
    if (smallflag) f=120;
    console.log("> scroll > "+ off, (ph-300)/2);
    if (document.getElementById("lead")){
        let imglead=document.getElementById("lead");
        let yacoff=(Math.pow(.002*po,2)*100)
        imglead.style.backgroundPosition= (yacoff+50)+"% 0px,"+(-yacoff+50)+"% 108px,"+(yacoff+50)+"% 216px,"+(-yacoff+50)+"% 324px,"+(yacoff+50)+"% 432px,"+(-yacoff+50)+"% 540px,"+(yacoff+50)+"% 648px,"+(-yacoff+50)+"% 756px,"+(yacoff+50)+"% 864px,"+(-yacoff+50)+"% 972px";
        console.log(imglead.style.backgroundPosition);
    }
    let projimgs=document.getElementsByClassName("project-image");
    for (let i =0; i < projimgs.length; i++) {
            let im=projimgs[i];
            // console.log(getTop(projimgs[i])-off);
            let val=(getTop(im)-off);
            let sval= scaleVal(val,0,300+(ph-300)/2,0,1);
            let powsval=Math.pow(sval,2);
            let abssval=1.5-0.6*Math.abs(powsval);
            if (smallflag) abssval+=3.5;
            // if(i==0)console.log(sval);
            im.children[0].width=300+(2*f*abssval);
            im.children[0].style.marginLeft = (30*sval+abssval*(-f))+"px";
            im.children[0].style.marginTop = abssval*(-f)+"px";
     }

//top: -222px;
    if (document.getElementById("skills")){
        let skillstop=getTop(document.getElementById("skills"))
        let skillsimgs=document.getElementsByClassName("skill_title");
        let skills_factor = 500-((po+(ph/2)-skillstop)*2%2500);
        for (let i =0; i < skillsimgs.length; i++) {
                let ul=skillsimgs[i];
                ul.style.setProperty("--top",skills_factor+ "px");
        
        }
    }
    if (document.getElementById("education")){
        let eduhimgs=document.getElementsByClassName("education-block");
        let eduh_factor = po*.1
        for (let i =0; i < eduhimgs.length; i++) {
                let im=eduhimgs[i];
                
                im.style.backgroundPosition= -eduh_factor + "% 0%," + eduh_factor + "% 100%, 50% 50%";
        
        }

        let eduvimg=document.getElementById("education");
        let eduv_factor = po*.4
        eduvimg.style.backgroundPosition=  "0% " + -eduv_factor + "%, 5.263158% " + eduv_factor + "%, 10.526316% " + -eduv_factor + "%, 15.789474% " + eduv_factor + "%, 21.052632% " + -eduv_factor + "%, 26.315789% " + eduv_factor + "%, 31.578947% " + -eduv_factor + "%, 36.842105% " + eduv_factor + "%, 42.105263% " + -eduv_factor + "%, 47.368421% " + eduv_factor + "%, 52.631579% " + -eduv_factor + "%, 57.894737% " + eduv_factor + "%, 63.157895% " + -eduv_factor + "%, 68.421053% " + eduv_factor + "%, 73.684211% " + -eduv_factor + "%, 78.947368% " + eduv_factor + "%, 84.210526% " + -eduv_factor + "%, 89.473684% " + eduv_factor + "%, 94.736842% " + -eduv_factor + "%, 100% " + eduv_factor + "%";
    }
}